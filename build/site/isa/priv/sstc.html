<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V ISA Documentation Library Antora Demo Site</title>
    <link rel="canonical" href="https://docs.riscv.org/isa/priv/sstc.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.riscv.org">RISC-V ISA Documentation Library Antora Demo Site</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="isa" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">ISA Specifications</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../isa/index.html">RISC-V Documentation Library</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Volume I: RISC-V Unprivileged ISA Specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/colophon.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/rv32.html">RV32I Base Integer Instruction Set, Version 2.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/rv32e.html">RV32E and RV64E Base Integer Instruction Sets, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/rv64.html">RV64I Base Integer Instruction Set, Version 2.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/rv128.html">RV128I Base Integer Instruction Set, Version 1.7</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zifencei.html">"Zifencei" Extension for Instruction-Fetch Fence, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zicsr.html">"Zicsr", Extension for Control and Status Register (CSR) Instructions, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/counters.html">"Zicntr" and "Zihpm" Extensions for Counters, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zihintntl.html">"Zihintntl" Extension for Non-Temporal Locality Hints, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zihintpause.html">"Zihintpause" Extension for Pause Hint, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zimop.html">"Zimop" Extension for May-Be-Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zicond.html">"Zicond" Extension for Integer Conditional Operations, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/m-st-ext.html">"M" Extension for Integer Multiplication and Division, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/a-st-ext.html">"A" Extension for Atomic Instructions, Version 2.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zawrs.html">"Zawrs" Extension for Wait-on-Reservation-Set instructions, Version 1.01</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zacas.html">"Zacas" Extension for Atomic Compare-and-Swap (CAS) Instructions, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zabha.html">"Zabha" Extension for Byte and Halfword Atomic Memory Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/rvwmo.html">RVWMO Memory Consistency Model, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/ztso-st-ext.html">"Ztso" Extension for Total Store Ordering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/cmo.html">"CMO" Extensions for Base Cache Management Operation ISA, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/f-st-ext.html">"F" Extension for Single-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/d-st-ext.html">"D" Extension for Double-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/q-st-ext.html">"Q" Extension for Quad-Precision Floating-Point, Version 2.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zfh.html">"Zfh" and "Zfhmin" Extensions for Half-Precision Floating-Point, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/bfloat16.html">"BF16" Extensions for for BFloat16-precision Floating-Point, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zfa.html">"Zfa" Extension for Additional Floating-Point Instructions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zfinx.html">"Zfinx", "Zdinx", "Zhinx", "Zhinxmin" Extensions for Floating-Point in Integer Registers, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/c-st-ext.html">"C" Extension for Compressed Instructions, Version 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/zc.html">"Zc*" Extension for Code Size Reduction, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/b-st-ext.html">"B" Extension for Bit Manipulation, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/j-st-ext.html">"J" Extension for Dynamically Translated Languages, Version 0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/p-st-ext.html">"P" Extension for Packed-SIMD Instructions, Version 0.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/v-st-ext.html">"V" Standard Extension for Vector Operations, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/scalar-crypto.html">Cryptography Extensions: Scalar &amp; Entropy Source Instructions, Version 1.0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/vector-crypto.html">Cryptography Extensions: Vector Instructions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/unpriv-cfi.html">Control-flow Integrity (CFI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/rv-32-64g.html">RV32/64G Instruction Set Listings</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/extending.html">Extending RISC-V</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/naming.html">ISA Extension Naming Conventions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/history.html">History and Acknowledgments</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/mm-eplan.html">Appendix A: RVWMO Explanatory Material, Version 0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/mm-formal.html">Appendix B: Formal Memory Model Specifications, Version 0.1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/vector-examples.html">Appendix C: Vector Assembly Code Examples</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unpriv/calling-convention.html">Appendix D: Calling Convention for Vector State (Not authoritative - Placeholder Only)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Volume II: RISC-V Privileged ISA Specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="priv-preface.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="priv-intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="priv-csrs.html">Control and Status Registers (CSRs)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="machine.html">Machine-Level ISA, Version 1.13</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="smstateen.html">"Smstateen/Ssstateen" Extensions, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="indirect-csr.html">"Smcsrind/Sscsrind" Indirect CSR Access, version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="smepmp.html">"Smepmp" Extension for PMP Enhancements for memory access and execution prevention in Machine mode, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="smcntrpmf.html">"Smcntrpmf" Cycke and Instret Privilege Mode Filtering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="rnmi.html">"Smrnmi" Extension for Resumable Non-Maskable Interrupts, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="smcdeleg.html">"Smcdeleg" Counter Delegation Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="smdbltrp.html">"Smdbltrp" Double Trap Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="supervisor.html">Supervisor-Level ISA, Version 1.13</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="sstc.html">"Sstc" Extension for Supervisor-mode Timer Interrupts, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="sscofpmf.html">"Sscofpmf" Extension for Count Overflow and Mode-Based Filtering, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="hypervisor.html">"H" Extension for Hypervisor Support, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="priv-cfi.html">Control-flow Integrity(CFI)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ssdbltrp.html">"Ssdbltrp" Double Trap Extension, Version 1.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#zpm.adoc">Pointer Masking Extensions, Version 1.0.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="priv-insns.html">RISC-V Privileged Instruction Set Listings</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="priv-history.html">History</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="bibliography.html">Bibliography</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ISA Specifications</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">ISA Specifications</a></div>
    </li>
    <li class="component">
      <div class="title"><a href="../../riscv-library/0.1/index.html">RISC-V Documentation Library</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../riscv-library/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../riscv-library/0.1/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">ISA Specifications</a></li>
    <li>Volume II: RISC-V Privileged ISA Specification</li>
    <li><a href="sstc.html">"Sstc" Extension for Supervisor-mode Timer Interrupts, Version 1.0</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/riscv/riscv-isa-manual/edit/antora-refactor/modules/priv/pages/sstc.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="Sstc"><a class="anchor" href="#Sstc"></a>"Sstc" Extension for Supervisor-mode Timer Interrupts, Version 1.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The current Privileged arch specification only defines a hardware mechanism for
generating machine-mode timer interrupts (based on the mtime and mtimecmp
registers). With the resultant requirement that timer services for
S-mode/HS-mode (and for VS-mode) have to all be provided by M-mode - via SBI
calls from S/HS-mode up to M-mode (or VS-mode calls to HS-mode and then to
M-mode). M-mode software then multiplexes these multiple logical timers onto
its one physical M-mode timer facility, and the M-mode timer interrupt handler
passes timer interrupts back down to the appropriate lower privilege mode.</p>
</div>
<div class="paragraph">
<p>This extension serves to provide supervisor mode with its own CSR-based timer
interrupt facility that it can directly manage to provide its own timer service
(in the form of having its own stimecmp register) - thus eliminating the large
overheads for emulating S/HS-mode timers and timer interrupt generation up in
M-mode. Further, this extension adds a similar facility to the Hypervisor
extension for VS-mode.</p>
</div>
<div class="paragraph">
<p>To make it easy to understand the deltas from the current Priv 1.11/1.12 specs,
this is written as the actual exact changes to be made to existing paragraphs
of Priv spec text (or additional paragraphs within the existing text).</p>
</div>
<div class="paragraph">
<p>The extension name is "Sstc" ('Ss' for Privileged arch and Supervisor-level
extensions, and 'tc' for timecmp). This extension adds the S-level stimecmp CSR
and the VS-level vstimecmp CSR.</p>
</div>
<div class="sect2">
<h3 id="_machine_and_supervisor_level_additions"><a class="anchor" href="#_machine_and_supervisor_level_additions"></a>Machine and Supervisor Level Additions</h3>
<div class="sect3">
<h4 id="_supervisor_timer_stimecmp_register"><a class="anchor" href="#_supervisor_timer_stimecmp_register"></a>Supervisor Timer (<code>stimecmp</code>) Register</h4>
<div class="paragraph">
<p>This extension adds this new CSR.</p>
</div>
<div class="paragraph">
<p>The <code>stimecmp</code> CSR is a 64-bit register and has 64-bit precision on all RV32 and
RV64 systems. In RV32 only, accesses to the <code>stimecmp</code> CSR access the low 32
bits, while accesses to the <code>stimecmph</code> CSR access the high 32 bits of <code>stimecmp</code>.</p>
</div>
<div class="paragraph">
<p>The CSR numbers for <code>stimecmp</code> / <code>stimecmph</code> are 0x14D / 0x15D (within the
Supervisor Trap Setup block of CSRs).</p>
</div>
<div class="paragraph">
<p>A supervisor timer interrupt becomes pending, as reflected in the STIP bit in
the <code>mip</code> and <code>sip</code> registers whenever <code>time</code> contains a value greater than or
equal to <code>stimecmp</code>, treating the values as unsigned integers.
If the result of this comparison changes, it is guaranteed to be reflected in
STIP eventually, but not necessarily immediately.
The interrupt remains posted until <code>stimecmp</code> becomes greater than <code>time</code>,
typically as a result of writing <code>stimecmp</code>.
The interrupt will be taken based on the standard interrupt enable and
delegation rules.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A spurious timer interrupt might occur if an interrupt handler advances
<code>stimecmp</code> then immediately returns, because STIP might not yet have fallen in
the interim. All software should be written to assume this event is possible,
but most software should assume this event is extremely unlikely. It is almost
always more performant to incur an occasional spurious timer interrupt than to
poll STIP until it falls.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In systems in which a supervisor execution environment (SEE) provides timer
facilities via an SBI function call, this SBI call will continue to support
requests to schedule a timer interrupt. The SEE will simply make use of
stimecmp, changing its value as appropriate. This ensures compatibility with
existing S-mode software that uses this SEE facility, while new S-mode software
takes advantage of stimecmp directly.)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_machine_interrupt_mip_and_mie_registers"><a class="anchor" href="#_machine_interrupt_mip_and_mie_registers"></a>Machine Interrupt (<code>mip</code> and <code>mie</code>) Registers</h4>
<div class="paragraph">
<p>This extension modifies the description of the STIP/STIE bits in these
registers as follows:</p>
</div>
<div class="paragraph">
<p>If supervisor mode is implemented, its mip.STIP and mie.STIE are the
interrupt-pending and interrupt-enable bits for supervisor-level timer
interrupts. If the stimecmp register is not implemented, STIP is writable in
mip, and may be written by M-mode software to deliver timer interrupts to
S-mode. If the <code>stimecmp</code> (supervisor-mode timer compare) register is
implemented, STIP is read-only in mip and reflects the supervisor-level timer
interrupt signal resulting from stimecmp. This timer interrupt signal is
cleared by writing <code>stimecmp</code> with a value greater than the current time value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_supervisor_interrupt_sip_and_sie_registers"><a class="anchor" href="#_supervisor_interrupt_sip_and_sie_registers"></a>Supervisor Interrupt (<code>sip</code> and <code>sie</code>) Registers</h4>
<div class="paragraph">
<p>This extension modifies the description of the STIP/STIE bits in these
registers as follows:</p>
</div>
<div class="paragraph">
<p>Bits <code>sip</code>.STIP and <code>sie</code>.STIE are the interrupt-pending and interrupt-enable bits
for supervisor level timer interrupts. If implemented, STIP is read-only in
sip, and is either set and cleared by the execution environment (if <code>stimecmp</code> is
not implemented), or reflects the timer interrupt signal resulting from
<code>stimecmp</code> (if <code>stimecmp</code> is implemented). The <code>sip</code>.STIP bit, in response to timer
interrupts generated by <code>stimecmp</code>, is set and cleared by writing <code>stimecmp</code> with a
value that respectively is less than or equal to, or greater than, the current
time value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_machine_counter_enable_mcounteren_register"><a class="anchor" href="#_machine_counter_enable_mcounteren_register"></a>Machine Counter-Enable (<code>mcounteren</code>) Register</h4>
<div class="paragraph">
<p>This extension adds to the description of the TM bit in this register as
follows:</p>
</div>
<div class="paragraph">
<p>In addition, when the TM bit in the mcounteren register is clear, attempts to
access the <code>stimecmp</code> or <code>vstimecmp</code> register while executing in a mode less
privileged than M will cause an illegal instruction exception.  When this bit
is set, access to the <code>stimecmp</code> or <code>vstimecmp</code> register is permitted in S-mode if
implemented, and access to the <code>vstimecmp</code> register (via <code>stimecmp</code>) is permitted
in VS-mode if implemented and not otherwise prevented by the TM bit in
<code>hcounteren</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hypervisor_extension_additions"><a class="anchor" href="#_hypervisor_extension_additions"></a>Hypervisor Extension Additions</h3>
<div class="sect3">
<h4 id="_virtual_supervisor_timer_vstimecmp_register"><a class="anchor" href="#_virtual_supervisor_timer_vstimecmp_register"></a>Virtual Supervisor Timer (<code>vstimecmp</code>) Register</h4>
<div class="paragraph">
<p>This extension adds this new CSR.</p>
</div>
<div class="paragraph">
<p>The <code>vstimecmp</code> CSR is a 64-bit register and has 64-bit precision on all RV32 and
RV64 systems. In RV32 only, accesses to the <code>vstimecmp</code> CSR access the low 32
bits, while accesses to the <code>vstimecmph</code> CSR access the high 32 bits of
vstimecmp.</p>
</div>
<div class="paragraph">
<p>The proposed CSR numbers for <code>vstimecmp</code> / <code>vstimecmph</code> are 0x24D / 0x25D (within
the Virtual Supervisor Registers block of CSRs, and mirroring the CSR numbers
for stimecmp/stimecmph).</p>
</div>
<div class="paragraph">
<p>A virtual supervisor timer interrupt becomes pending, as reflected in the
VSTIP bit in the <code>hip</code> register, whenever (<code>time</code> + <code>htimedelta</code>), truncated
to 64 bits, contains a value greater than or equal to <code>vstimecmp</code>, treating
the values as unsigned integers.
If the result of this comparison changes, it is guaranteed to be reflected in
VSTIP eventually, but not necessarily immediately.
The interrupt remains posted until <code>vstimecmp</code> becomes greater than (<code>time</code>
+ <code>htimedelta</code>), typically as a result of writing <code>vstimecmp</code>.
The interrupt will be taken based on the standard interrupt enable and
delegation rules while V=1.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In systems in which a supervisor execution environment (SEE) implemented by an
HS-mode hypervisor provides timer facilities via an SBI function call, this SBI
call will continue to support requests to schedule a timer interrupt. The SEE
will simply make use of vstimecmp, changing its value as appropriate. This
ensures compatibility with existing guest VS-mode software that uses this SEE
facility, while new VS-mode software takes advantage of vstimecmp directly.)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hypervisor_interrupt_hvip_hip_and_hie_registers"><a class="anchor" href="#_hypervisor_interrupt_hvip_hip_and_hie_registers"></a>Hypervisor Interrupt (<code>hvip</code>, <code>hip</code>, and <code>hie</code>) Registers</h4>
<div class="paragraph">
<p>This extension modifies the description of the VSTIP/VSTIE bits in the hip/hie
registers as follows:</p>
</div>
<div class="paragraph">
<p>Bits hip.VSTIP and hie.VSTIE are the interrupt-pending and interrupt-enable
bits for VS-level timer interrupts. VSTIP is read-only in hip, and is the
logical-OR of hvip.VSTIP and the timer interrupt signal resulting from
<code>vstimecmp</code> (if <code>vstimecmp</code> is implemented). The <code>hip</code>.VSTIP bit, in response to
timer interrupts generated by <code>vstimecmp</code>, is set and cleared by writing
<code>vstimecmp</code> with a value that respectively is less than or equal to, or greater
than, the current (<code>time</code> + <code>htimedelta</code>) value. The <code>hip</code>.VSTIP bit remains defined
while V=0 as well as V=1.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hypervisor_counter_enable_hcounteren_register"><a class="anchor" href="#_hypervisor_counter_enable_hcounteren_register"></a>Hypervisor Counter-Enable (<code>hcounteren</code>) Register</h4>
<div class="paragraph">
<p>This extension adds to the description of the TM bit in this register as
follows:</p>
</div>
<div class="paragraph">
<p>In addition, when the TM bit in the <code>hcounteren</code> register is clear, attempts to
access the <code>vstimecmp</code> register (via stimecmp) while executing in VS-mode will
cause a virtual instruction exception if the same bit in <code>mcounteren</code> is set.
When this bit and the same bit in <code>mcounteren</code> are both set, access to the
<code>vstimecmp</code> register (if implemented) is permitted in VS-mode.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_environment_config_menvcfg_and_henvcfg_support"><a class="anchor" href="#_environment_config_menvcfg_and_henvcfg_support"></a>Environment Config (<code>menvcfg</code> and <code>henvcfg</code>) Support</h3>
<div class="paragraph">
<p>Enable/disable bits for this extension are provided in the new <code>menvcfg</code> /
<code>henvcfg</code> CSRs.</p>
</div>
<div class="paragraph">
<p>Bit 63 of <code>menvcfg</code> (or bit 31 of <code>menvcfgh</code>) - named STCE (STimecmp Enable) -
enables <code>stimecmp</code> for S-mode when set to one, and the same bit of henvcfg
enables <code>vstimecmp</code> for VS-mode. These STCE bits are WARL and are hard-wired to 0
when this extension is not implemented.</p>
</div>
<div class="paragraph">
<p>When this extension is implemented and STCE in <code>menvcfg</code> is zero, an attempt to access <code>stimecmp</code> or <code>vstimecmp</code> in a
mode other than M-mode raises an illegal instruction exception, STCE in <code>henvcfg</code>
is read-only zero, and STIP in <code>mip</code> and <code>sip</code> reverts to its defined behavior as
if this extension is not implemented. Further, if the H extension is implemented, then hip.VSTIP also reverts its defined behavior as if this extension is not implemented.</p>
</div>
<div class="paragraph">
<p>But when STCE in <code>menvcfg</code> is one and STCE in <code>henvcfg</code> is zero, an attempt to access
<code>stimecmp</code> (really <code>vstimecmp</code>) when V = 1 raises a virtual instruction exception,
and VSTIP in hip reverts to its defined behavior as if this extension is not
implemented.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
